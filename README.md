# Word文档拆分工具

这是一个高性能的Word文档拆分工具，能够根据文档的标题结构智能地将大型Word文档拆分为多个独立的小文档。特别适用于学术论文、技术文档、培训材料等具有清晰章节结构的文档。

## 🌟 核心特性

- 🔍 **智能标题识别**: 支持Word标准标题样式、大纲级别和自定义样式（如"样式3"、"样式4"等）
- 📄 **完整格式保持**: 100%保留原文档的文字、图片、表格、格式、样式和布局
- 🧵 **双层多线程**: 文档级和章节级双重并行处理，显著提升处理速度
- 📁 **智能批量处理**: 自动扫描输入目录，批量处理多个Word文档
- ⚙️ **灵活配置**: 支持自定义拆分层级、线程数、输入输出目录等参数
- 📊 **实时进度显示**: 带进度条的处理状态显示，支持处理时间统计
- 🛡️ **错误处理**: 完善的异常处理和日志记录机制
- 🎯 **章节标题识别**: 支持中文章节格式（一、二、三、）和数字格式（1、2、3、）

## 📋 系统要求

- **Python版本**: Python 3.7+ （推荐Python 3.11+）
- **操作系统**: Windows、macOS、Linux（推荐Windows以获得最佳兼容性）
- **内存**: 建议4GB以上（处理大型文档时需要更多内存）
- **存储**: 确保有足够的磁盘空间存储拆分后的文档
- **文档格式**: 支持.docx和.doc格式的Microsoft Word文档

## 🚀 快速开始

### 1. 克隆或下载项目

```bash
git clone <repository-url>
cd word-document-splitter
```

### 2. 安装依赖

```bash
pip install -r requirements.txt
```

**依赖说明**:
- `python-docx>=0.8.11`: Word文档处理核心库
- `tqdm`: 进度条显示（可选，如未安装会使用简单进度显示）

### 3. 准备文档

创建输入目录并放入要拆分的Word文档：

```bash
mkdir input
# 将你的.docx或.doc文件复制到input文件夹中
```

### 4. 运行程序

```bash
python main.py
```

## 📁 项目结构

```
word-document-splitter/
├── main.py                 # 主程序入口，包含用户配置参数
├── word_splitter.py        # 核心拆分逻辑和文档处理器
├── requirements.txt        # 项目依赖列表
├── README.md              # 项目说明文档
├── run_splitter.bat       # Windows批处理脚本（可选）
├── word_splitter.log      # 程序运行日志（自动生成）
├── __pycache__/           # Python缓存目录（自动生成）
├── input/                 # 输入文档目录（需要手动创建）
│   ├── 文档1.docx
│   ├── 文档2.docx
│   └── ...
└── output/                # 输出文档目录（自动创建）
    ├── 文档1/
    │   ├── 第一章 概述.docx
    │   ├── 第二章 详细内容.docx
    │   └── ...
    ├── 文档2/
    │   ├── 一、绪论.docx
    │   ├── 二、研究背景.docx
    │   └── ...
    └── ...
```

## 📖 详细使用指南

### 基本使用流程

1. **准备文档**: 将要拆分的Word文档放入`input`目录
2. **配置参数**: 根据需要修改`main.py`中的配置参数
3. **运行程序**: 执行`python main.py`
4. **查看结果**: 在`output`目录中查看拆分后的文档

### 支持的文档格式

- ✅ `.docx` 格式（推荐）
- ✅ `.doc` 格式
- ❌ 密码保护的文档
- ❌ 损坏的文档

### 标题识别规则

工具能够识别以下类型的标题：

1. **Word标准标题样式**:
   - 英文: `Heading 1`, `Heading 2`, `Heading 3`...
   - 中文: `标题 1`, `标题 2`, `标题 3`...

2. **Word大纲级别**: 通过段落格式设置的大纲级别

3. **自定义样式**: 
   - `样式1`, `样式2`, `样式3`... （常见于学术论文）
   - 需要内容符合标题特征（如章节格式、关键词等）

4. **章节格式识别**:
   - 中文: `一、`, `二、`, `三、`...
   - 数字: `1、`, `2、`, `3、`...
   - 常见标题关键词: `绪论`, `引言`, `结论`, `参考文献`等

### 拆分逻辑说明

- **最小拆分层级**: 默认为5级，即只有达到5级或更深的标题才会被拆分
- **层级不连续处理**: 如果文档层级不连续（如1→3→5），会自动调整到最小可拆分层级
- **内容完整性**: 每个拆分文档包含从当前标题到下一个同级或更高级标题之前的所有内容
- **格式保持**: 完整保留原文档的所有格式、样式、图片、表格等元素

## ⚙️ 配置参数详解

在 `main.py` 文件的 `main()` 函数中，你可以修改以下配置参数：

```python
def main():
    # ==================== 配置参数 ====================
    
    # 输入输出目录
    INPUT_DIR = "input"          # 输入文档目录
    OUTPUT_DIR = "output"        # 输出文档目录
    
    # 文档拆分配置
    MIN_LEVEL = 5               # 最小拆分层级（1-6）
    
    # 多线程配置
    FILE_THREAD_COUNT = 4       # 处理多个文档的线程数（建议1-8）
    CHAPTER_THREAD_COUNT = 4    # 处理单个文档章节的线程数（建议1-4）
```

### 📋 参数详细说明

| 参数 | 类型 | 默认值 | 范围 | 说明 |
|------|------|--------|------|------|
| `INPUT_DIR` | string | "input" | - | 输入文档所在目录路径 |
| `OUTPUT_DIR` | string | "output" | - | 拆分后文档的输出目录路径 |
| `MIN_LEVEL` | int | 5 | 1-6 | 最小拆分层级，对应Word标题1-6 |
| `FILE_THREAD_COUNT` | int | 4 | 1-16 | 同时处理多个文档的线程数 |
| `CHAPTER_THREAD_COUNT` | int | 4 | 1-8 | 处理单个文档内章节的线程数 |

### 🎯 MIN_LEVEL 拆分层级说明

- **1**: 只拆分一级标题（章）
- **2**: 拆分到二级标题（节）
- **3**: 拆分到三级标题（小节）
- **4**: 拆分到四级标题（子小节）
- **5**: 拆分到五级标题（详细章节）- **默认推荐**
- **6**: 拆分到六级标题（最细粒度）

**选择建议**:
- 学术论文: 建议使用 3-4 级
- 技术文档: 建议使用 4-5 级
- 培训材料: 建议使用 2-3 级

## 🚀 多线程性能优化

### 双层多线程架构

本工具采用双层多线程设计：
- **文档级线程池**: 并行处理多个Word文档
- **章节级线程池**: 并行处理单个文档内的多个章节

**总线程数 = FILE_THREAD_COUNT × CHAPTER_THREAD_COUNT**

### 🎯 线程配置策略

#### 根据文档特征调整

| 文档类型 | 文档数量 | 推荐配置 | 说明 |
|----------|----------|----------|------|
| 大型文档 | 1-3个 | `FILE=1-2, CHAPTER=3-4` | 重点优化章节处理 |
| 中等文档 | 4-10个 | `FILE=2-4, CHAPTER=2-3` | 平衡文档和章节处理 |
| 小型文档 | 10+个 | `FILE=4-8, CHAPTER=1-2` | 重点优化文档并行 |

#### 根据硬件配置调整

| 硬件类型 | 推荐配置 | 原因 |
|----------|----------|------|
| **SSD + 8GB+ 内存** | `FILE=4-8, CHAPTER=2-4` | 高I/O性能，支持更多并发 |
| **SSD + 4GB 内存** | `FILE=2-4, CHAPTER=2-3` | 平衡性能和内存使用 |
| **HDD + 8GB+ 内存** | `FILE=2-4, CHAPTER=2-3` | 避免磁盘I/O竞争 |
| **HDD + 4GB 内存** | `FILE=1-2, CHAPTER=1-2` | 保守配置，确保稳定性 |

### ⚡ 性能优化建议

1. **内存优化**:
   - 处理大型文档时，适当降低线程数
   - 监控内存使用，避免内存不足

2. **磁盘I/O优化**:
   - SSD用户可以使用更高的`FILE_THREAD_COUNT`
   - HDD用户建议降低并发数，避免磁盘竞争

3. **CPU优化**:
   - 多核CPU可以适当增加总线程数
   - 单核或双核CPU建议保守配置

### 📊 性能监控

程序运行时会显示：
- 实时处理进度
- 每个文档的处理状态
- 总处理时间统计
- 详细日志记录在`word_splitter.log`

## 📋 拆分规则详解

### 核心拆分逻辑

1. **层级识别**: 自动识别文档中的标题层级结构
2. **最小拆分层级**: 根据`MIN_LEVEL`参数确定拆分深度
3. **智能层级调整**: 如果文档层级不连续，自动调整到合适的拆分层级
4. **内容完整性**: 确保每个拆分文档包含完整的章节内容
5. **格式保持**: 100%保留原文档的所有元素和格式

### 拆分示例

假设有以下文档结构：
```
第一章 概述 (级别1)
├── 1.1 背景介绍 (级别2)
│   ├── 1.1.1 历史发展 (级别3)
│   └── 1.1.2 现状分析 (级别3)
└── 1.2 研究意义 (级别2)
第二章 方法 (级别1)
├── 2.1 理论基础 (级别2)
└── 2.2 实验设计 (级别2)
```

**当MIN_LEVEL=3时**，会生成：
- `第一章 概述 - 1.1 背景介绍 - 1.1.1 历史发展.docx`
- `第一章 概述 - 1.1 背景介绍 - 1.1.2 现状分析.docx`
- `第一章 概述 - 1.2 研究意义.docx`
- `第二章 方法 - 2.1 理论基础.docx`
- `第二章 方法 - 2.2 实验设计.docx`

## 📝 日志记录

### 日志文件
- **文件名**: `word_splitter.log`
- **编码**: UTF-8
- **位置**: 项目根目录

### 日志内容
- 文档处理开始和结束时间
- 章节识别和拆分过程
- 错误和异常信息
- 性能统计数据

### 日志级别
- **INFO**: 正常处理信息
- **WARNING**: 警告信息（如参数超出范围）
- **ERROR**: 错误信息（如文档无法打开）

## ⚠️ 注意事项

### 文档要求
- ✅ 确保Word文档没有密码保护
- ✅ 文档格式为`.docx`或`.doc`
- ✅ 文档结构清晰，有明确的标题层级
- ✅ 文档没有损坏或格式错误

### 系统资源
- 💾 确保有足够的磁盘空间（建议至少为原文档大小的2-3倍）
- 🧠 处理大型文档时注意内存使用情况
- ⏱️ 复杂文档（大量图片、表格）处理时间较长

### 数据安全
- 🔒 **强烈建议**在处理重要文档前先备份
- 📁 输出目录会自动创建，不会覆盖现有文件
- 🗂️ 每次运行会在输出目录创建新的子目录

## 🔧 故障排除

### 安装问题

**问题**: `ImportError: No module named 'docx'`
```bash
# 解决方案
pip install python-docx
# 或者
pip install -r requirements.txt
```

**问题**: `ModuleNotFoundError: No module named 'tqdm'`
```bash
# 解决方案（可选，程序会自动降级）
pip install tqdm
```

### 文档处理问题

**问题**: 文档无法打开
- ✅ 检查文档是否损坏
- ✅ 确认文档格式为`.docx`或`.doc`
- ✅ 检查文档是否有密码保护
- ✅ 确认文档路径正确，没有特殊字符

**问题**: 章节识别不准确
- ✅ 检查文档的标题样式设置
- ✅ 确认段落大纲级别设置正确
- ✅ 尝试调整`MIN_LEVEL`参数
- ✅ 查看日志文件了解详细信息

**问题**: 拆分后文档格式丢失
- ✅ 确认原文档格式正确
- ✅ 检查是否使用了不支持的Word功能
- ✅ 尝试将原文档另存为标准`.docx`格式

### 性能问题

**问题**: 处理速度慢
- ✅ 调整线程配置参数
- ✅ 检查磁盘空间和内存使用
- ✅ 关闭其他占用资源的程序
- ✅ 考虑分批处理大量文档

**问题**: 内存不足
- ✅ 降低`CHAPTER_THREAD_COUNT`参数
- ✅ 减少同时处理的文档数量
- ✅ 关闭其他程序释放内存

### 输出问题

**问题**: 输出目录为空
- ✅ 检查输入目录是否包含Word文档
- ✅ 确认文档是否有可识别的标题结构
- ✅ 查看控制台输出和日志文件
- ✅ 尝试降低`MIN_LEVEL`参数

## 🔬 技术实现

### 核心技术栈
- **文档处理**: `python-docx` - Word文档读写和操作
- **多线程**: `concurrent.futures.ThreadPoolExecutor` - 高性能并行处理
- **进度显示**: `tqdm` - 实时进度条和状态显示
- **日志记录**: `logging` - 完整的日志记录和错误追踪

### 关键算法
1. **智能标题识别算法**:
   - 支持Word标准标题样式识别
   - 大纲级别分析
   - 自定义样式模式匹配
   - 内容特征分析（章节格式、关键词等）

2. **文档结构分析**:
   - 递归层级分析
   - 章节范围计算
   - 内容完整性保证

3. **格式保持技术**:
   - 完整的段落格式复制
   - 图片和表格元素保持
   - 样式和布局保留
   - 文档属性继承

### 性能优化
- **双层线程池设计**: 文档级和章节级并行处理
- **内存管理**: 智能垃圾回收和内存优化
- **I/O优化**: 批量文件操作和缓存机制

## 📊 使用示例

### 处理学术论文
```bash
# 配置建议：MIN_LEVEL=3, FILE_THREAD_COUNT=2, CHAPTER_THREAD_COUNT=3
python main.py
```

### 处理技术文档
```bash
# 配置建议：MIN_LEVEL=4, FILE_THREAD_COUNT=4, CHAPTER_THREAD_COUNT=2
python main.py
```

### 批量处理大量文档
```bash
# 配置建议：MIN_LEVEL=5, FILE_THREAD_COUNT=6, CHAPTER_THREAD_COUNT=1
python main.py
```

## 🤝 贡献指南

欢迎贡献代码和建议！

1. Fork 本项目
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启 Pull Request

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 👨‍💻 作者

**QiyanLiu** - *初始开发* 

## 🙏 致谢

- 感谢 `python-docx` 库提供的强大Word文档处理能力
- 感谢所有测试用户提供的宝贵反馈和建议

---

**如果这个工具对你有帮助，请给个 ⭐ Star！**